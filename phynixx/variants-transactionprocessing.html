<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-01-04 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150104" />
    <meta http-equiv="Content-Language" content="en" />
    <title>phynixx - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Phynixx's Parent Project</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-01-04
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.0.0-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Phynixx</li>
                              
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <i class="none"></i>
        Project Information</a>
            </li>
                              <li class="nav-header">Documentation</li>
                              
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                
      <li>
  
                          <a href="tutorial.html" title="Tutorial">
          <i class="none"></i>
        Tutorial</a>
            </li>
                
      <li>
  
                          <a href="background.html" title="Background">
          <i class="none"></i>
        Background</a>
            </li>
                
      <li>
  
                          <a href="references.html" title="Referenzen">
          <i class="none"></i>
        Referenzen</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="phynixx-common/index.html" title="phynixx-common">
          <i class="none"></i>
        phynixx-common</a>
            </li>
                
      <li>
  
                          <a href="phynixx-logger/index.html" title="phynixx-logger">
          <i class="none"></i>
        phynixx-logger</a>
            </li>
                
      <li>
  
                          <a href="phynixx-connection/index.html" title="phynixx-connection">
          <i class="none"></i>
        phynixx-connection</a>
            </li>
                
      <li>
  
                          <a href="phynixx-watchdog/index.html" title="phynixx-watchdog">
          <i class="none"></i>
        phynixx-watchdog</a>
            </li>
                
      <li>
  
                          <a href="phynixx-xa/index.html" title="phynixx-xa">
          <i class="none"></i>
        phynixx-xa</a>
            </li>
                
      <li>
  
                          <a href="phynixx-jmx/index.html" title="phynixx-jmx">
          <i class="none"></i>
        phynixx-jmx</a>
            </li>
                
      <li>
  
                          <a href="phynixx-spring/index.html" title="Unnamed - org.csc:phynixx-spring:jar:2.0.0-SNAPSHOT">
          <i class="none"></i>
        Unnamed - org.csc:phynixx-spring:jar:2.0.0-SNAPSHOT</a>
            </li>
                
      <li>
  
                          <a href="phynixx-tutorial/index.html" title="Tutorial (how to use Phynixx)">
          <i class="none"></i>
        Tutorial (how to use Phynixx)</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Varianten der Transaktionsverarbeitung</h1>
<div class="section">
<h2>Last Resource Gambit<a name="Last_Resource_Gambit"></a></h2>
<p>In vielen F&#xe4;llen kann man sich mit dem so genannten mit dem Verfahren helfen, das in the Last Resource Gambit bezeichnet wird. Die Transaktionssteuerung wei&#xdf; um die einzelnen Charakteristika der Persistenzsysteme und stellt ihre Verarbeitungslogik darauf ein.</p>
<p>Ist z.B. nur ein nicht XA-kompatible Persistenzmedium an der Transaktion beteiltigt, so wird nachdem prepare an alle anderen beteiligten Resourcen das commit der Nicht-kompatiblen gerufen und anschlie&#xdf;end das commit der XA-Resourcen. Dieses Verfahren l&#xf6;st zwar auch nicht das oben beschrieben Problem der irreversiblen Aktionen, die w&#xe4;hrend des <i>prepare phase</i> fehlschlagen, aber dasjenige des rollbacks nach erfolgreicher prepare-Phase.</p></div>
<div class="section">
<h2><i>Logging in presumed abort Algorithmus</i><a name="Logging_in_presumed_abort_Algorithmus"></a></h2>
<p>Der presumed abort - Algorithmus ist in [gupta-1997] definiert.</p>

<blockquote>
<p>&#x201e;&#x2026; , the 2PC protocol requires transmission of several messages and force-writing of several log records. A variant of the 2PC protocol, called presumed abort (PA), attempts to reduce these overheads by requiring all cohorts to follow a &#x201c;in the no information case, abort&#x201d; rule.&#x201c;</p>
</blockquote>
<p><i>presumed abort</i> bedeutet als Konsequenz, dass der Transaktionmanager die Transaktion nur vor und w&#xe4;hrend der eigentlichen <i>committing phase </i>( prepare,commit ) protokollieren muss. Insbesondere m&#xfc;ssen weder <i>rollback data</i> noch Informationen vor der *committing phase * protokolliert werden. Es werden ebenfalls keine Informationen f&#xfc;r Transaktionen geloggt, die zu 1PC optimiert wurden.</p>
<p>Das Verfahren <i>presumed abort</i> ist das g&#xe4;ngige Verfahren, nach dem Transaktionsmanager den Stand der aktuellen Transaktionen protokollieren.</p>
<p>Dieses Verfahren setzt im Falle eines Abbruchs voraus, dass alle eingesetzten ResourceManager in der Lage sind, ihre Resourcen zu restaurieren (recover). Der TM &#xfc;bernimmt nur eine Koordination der abgebrochenen Transaktion, wenn diese w&#xe4;hrend der committing phase ( 2PC mit prepare/commit) abgebrochen ist.</p>
<p>Ein Logging-Verfahren, dass diese Eigenschaft unterst&#xfc;tzt, hat im wesentliche folgende Funktionalit&#xe4;t. 1. Bevor ein Commit gestartet wird, werden alle beteiligten XAResourcen geloggt, so dass diese beim Wiederanlauf referenzierbar sind. 2. Es werden keinerlei inhaltliche Informationen &#xfc;ber den XAResourcen durch den Transaktionmanager geloggt. Diese ist Aufgabe des Resourcemanagers. 3. Falls die <i>committing phase</i> erfolgreich abgeschlossen wird, so sind die Recoveryinformationen (siehe 1) unn&#xf6;tigt und k&#xf6;nnten gel&#xf6;scht werden 4. Falls der Transaktionmanager w&#xe4;hrend der <i>commiting phase</i> abst&#xfc;rtzt, so kann auf Basis der <i>rollforward data</i> die Situation zum Zeitpunkt das Abbruchs wiederhergestellt werden. Dies allerdings nur aus Sicht des Transaktionmanagers (siehe unten). 5. XAResourcen m&#xfc;ssen ihre Transaktion-Informationen, die zur Integration in die Transaktion notwendigen Informationen wie XID) erst ab der prepare-Phase loggen. Zuvor allerdings m&#xfc;ssen evtl. Informationen f&#xfc;r recovery/rollback geloggt werden. 6. Wiederherstellung einer XAResource umfasst auch die Informationen, um die Referenz des TM auf diese XAResource (siehe 1) aufzul&#xf6;sen. Dazu ist in der Regel zu untersuchen, wie der gew&#xe4;hlte TM die XAResource referenziert (z.B. via toString() wie JOTM). 7. <i>XAResource.recover()</i> liefert alle wiederherstellbaren XAResources des RM. Dabei k&#xf6;nnen diejenigen, die nicht an wiederherstellbaren Transaktion beteiligt sind, ignoriert werden.</p>
<p>Ein Logging-Verfahren, dass diese Eigenschaft unterst&#xfc;tzt, hat im wesentliche folgende Funktionalit&#xe4;t.</p>

<ol style="list-style-type: decimal">
  
<li>performante, konkurrierende Protokollierung (selbstverst&#xe4;ndlich)</li>
  
<li>dauerhafte und atomare Protokollierung</li>
  
<li>B&#xfc;ndelung der Records der <i>committing phase</i> , nur ein I/O-Zugriff pro Start einer <i>committing phase</i></li>
  
<li>Ignorierung/L&#xf6;schen/&#xdc;berscheiben von Logrecords, die zu erfolgreich abgeschlossenene Transaktionen geh&#xf6;ren. Diese sollen im Log keinen Platz blockieren (garbage collection f&#xfc;r LogRecords).</li>
</ol>
<p>Ein hinsichtlich dieser Anforderungen optimiertes Loggingsystem ist offensichtlich nicht optimiert, recovery/rollback -Informationen f&#xfc;r eine XAResource zu unterst&#xfc;tzen. Dort muss die B&#xfc;ndelung nicht auf Basis der Records der Committing Phase sondern bzgl. aller w&#xe4;hrend einer Transaktion angefallenen Daten geschehen. Ist die Transaktion abgeschlossen, so sind diese geb&#xfc;ndelten Records freizugeben.</p>
<div class="section">
<h3>recovery in <i>presumed abort</i><a name="recovery_in_presumed_abort"></a></h3>
<p>Falls das Persistenzsystem an einer globale Transaktion beteiligt war und die Beteiligung wieder reaktiviert werden muss (nur Zustand <i>prepared</i>), so hat sich das restaurierte Persistenzsystem beim Transaktionsmanager f&#xfc;r die entsprechende globale Transaktion anzumelden.</p>
<p>F&#xfc;r den Transaktionsmanager ist eine XAResource nur dann beim Recovery interessant, wenn diese an einer Transaktion teilgenommen hat, deren <i>prepared/committing phase</i> wiederhergestellt wird. Ansonsten wei&#xdf; der Transaktionmanager (siehe* presumed abort * weiter unten) nichts &#xfc;ber die XAResource und diese kann sich isoliert wiederherstellen und ein <i>rollback</i> durchf&#xfc;hren.</p>
<p>Falls diese w&#xe4;hrend der <i>executing phase</i> stecken geblieben ist, so hat der Recoverymechanismus des Resourcemanagers f&#xfc;r ein korrekte Wiederherstellung des Persistenzsystems zu sorgen.</p>
<p>Ist sie dagegen w&#xe4;hrend der <i>preparing phase</i> abgebrochen, ist zu erwarten, dass die XAResource untersucht, ob es eine wiederhergestellte, globale Transaktion gibt, an der sie teilnehmen kann. Die XAResource wird dieser &#xfc;bergeben, allerdings im Zustand MARK_ROLLBACK. Dadurch ist gew&#xe4;hrleistet, dass alle an der Transaktion beteiligten XAResourcen rollbacked werden.</p>
<p>Da allerdings bei Transaktionmanagern die den Recoveryprozess gem&#xe4;&#xdf; <i>presumed abort</i> unterst&#xfc;tzen, globale Transaktionen, welche in der <i>preparing phase</i> abbrechen, nicht als wiederherstellbar protokollieren, ist es nicht notwendig, die aufwendige Sonderbehandlung f&#xfc;r die Fall vorzusehen. Auch in diesem Fall kann also der Recoverymanager des XAResource ein <i>rollback</i> durchf&#xfc;hren. Insbesondere wird der Zustand <i>preparing</i> nicht protokolliert.</p>
<p>Um all die Zustandsinformationen einer Transaktion zuordnen zu k&#xf6;nnen, muss beim Beginn der Beteiligung der XAResource an der Transaktion (Eintritt in executing ) protokolliert werden, mit welcher Identit&#xe4;t die XAResource an welcher Transaktion ( identifiziert durch XID) teilnimmt. Dieser Transaktion-Informationen m&#xfc;ssen auch allen weiteren LogRecords zugeordnet sein, die sich auf diese XAResource innerhalb dieser Transaktion beziehen. St&#xf6;&#xdf;t der Recoverymanager auf eine XAResource eines solchen Zustands, so zeigt folgende Tabelle, wie zu reagieren ist:</p>

<table border="0" class="table table-striped">

<tr class="a">
<td>erster Satz bei XAResource (nur bei XAResource bei Beteiligung an 2PC)</td>
<td>Um die XAResource der Transaktion zuzuordnen, sind aus dem erstem LogRecord sowohl Identit&#xe4;t der XAResource (zur Registrierung beim Transaktionsmanager) und XID zu ermitteln.</td></tr>

<tr class="b">
<td>Prepared</td>
<td>Da XAResource f&#xfc;r den Transaktionsmanager in Bezug auf Recovery nur nur im Zustand prepared / committing interessant sind, muss sich die XAResource an den Transaktion der wiederhergestellten globalen Transaktion beteiligen , um den TransaKtionsmanager die Transaktion geordnet abzuschliessen.</td></tr>

<tr class="a">
<td>committing</td>
<td>Nimmt die XAResource am 2PC teil, so siehe prepared . Ansonsten wird das commit vollst&#xe4;ndig zu Ende gef&#xfc;hrt.</td></tr>

<tr class="b">
<td>keiner der obigen Zust&#xe4;nde</td>
<td>XAResource f&#xfc;hrt abschliessende Arbeiten aus, um dass rollback/abort abzuschliessen. Es ist keine globale Transaktion notwendig, innerhalb derer die XAResource rollbacked werden muss.</td></tr>
</table></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
